# Инструкции по деплою на Render.com

## Подготовка к деплою

### 1. Подготовка репозитория

Убедитесь, что в репозитории есть все необходимые файлы:

```
test_video_call/
├── server.js              # Основной сервер
├── package.json           # Зависимости сервера
├── render.yaml            # Конфигурация Render
├── client/                # Next.js клиент
│   ├── src/
│   ├── package.json
│   ├── next.config.js     # Конфигурация для статической экспортации
│   └── ...
└── README.md
```

### 2. Настройка Render.com

1. Зайдите на [render.com](https://render.com)
2. Создайте аккаунт или войдите в существующий
3. Нажмите "New +" → "Web Service"
4. Подключите ваш GitHub/GitLab репозиторий

### 3. Конфигурация сервиса

Render автоматически обнаружит `render.yaml` и настроит:

- **Build Command**: `npm install && cd client && npm install && npm run build && cd ..`
- **Start Command**: `npm start`
- **Port**: 9788 (из переменной окружения)

### 4. Переменные окружения

Render автоматически установит:
- `PORT=9788`
- `NODE_ENV=production`

### 5. Деплой

1. Нажмите "Create Web Service"
2. Render начнет сборку проекта
3. Дождитесь завершения деплоя (обычно 5-10 минут)

## Проверка деплоя

### 1. Проверка сборки

В логах Render вы должны увидеть:
```
✓ Creating an optimized production build
✓ Exporting (2/2)
✓ Finalizing page optimization
```

### 2. Проверка сервера

- Откройте URL вашего сервиса
- Должна загрузиться страница видеосвязи
- Проверьте `/health` endpoint

### 3. Проверка WebSocket

- Откройте DevTools → Console
- Должно появиться: "Connected to server with ID: ..."

## Возможные проблемы

### 1. Ошибка сборки клиента

**Проблема**: Next.js не может собрать проект
**Решение**: Проверьте `next.config.js` и убедитесь, что `output: 'export'` установлен

### 2. WebSocket не подключается

**Проблема**: Клиент не может подключиться к серверу
**Решение**: Проверьте CORS настройки в `server.js`

### 3. Статические файлы не загружаются

**Проблема**: 404 ошибки для CSS/JS файлов
**Решение**: Убедитесь, что сервер правильно раздает папку `client/out`

### 4. Порт занят

**Проблема**: Render не может запустить сервер
**Решение**: Убедитесь, что сервер слушает на `process.env.PORT`

## Обновление деплоя

При каждом push в main ветку Render автоматически:
1. Запустит новую сборку
2. Соберет клиент
3. Перезапустит сервер

## Мониторинг

### Логи
- Доступны в Render Dashboard → Logs
- Показывают ошибки сервера и сборки

### Метрики
- Render предоставляет базовые метрики
- CPU, Memory, Response Time

## Стоимость

- **Free Tier**: 750 часов/месяц
- **Paid Plans**: от $7/месяц
- WebSocket соединения считаются как активные часы

## Альтернативы

### Vercel + Отдельный сервер
1. Деплой клиента на Vercel
2. Деплой сервера на Render/Railway/Heroku
3. Настройка CORS между сервисами

### Netlify + Отдельный сервер
1. Деплой клиента на Netlify
2. Деплой сервера на Render/Railway/Heroku
3. Настройка CORS между сервисами 